---

import ThemeToggle from "../ThemeToggle/ThemeToggle.astro";
import styles from "./Navbar.module.css";
---

<nav class={styles.nav} data-navbar>
  <div class={styles.left}>
    <span class={styles.logo}>AJ</span>
  </div>

  <div class={styles.center}>
    <a href="#about" data-nav-link>About</a>
    <a href="#experience" data-nav-link>Experience</a>
    <a href="#projects" data-nav-link>Projects</a>
    <a href="#skills" data-nav-link>Skills</a>
    <a href="#education" data-nav-link>Education</a>
    <a href="#contact" data-nav-link>Contact</a>
  </div>

  <div class={styles.right}>
    <ThemeToggle />
  </div>
</nav>

<script>
  (() => {
    const nav = document.querySelector("[data-navbar]");
    const main = document.querySelector("main");
    if (!nav || !main) return;

    const navLinks = Array.from(document.querySelectorAll("[data-nav-link]"));
    const prefersReducedMotion = window.matchMedia(
      "(prefers-reduced-motion: reduce)"
    ).matches;

    const scrollToHash = (hash, smooth = true) => {
      if (!hash || !hash.startsWith("#")) return;
      const target = document.querySelector(hash);
      if (!target) return;

      const navRect = nav.getBoundingClientRect();
      const offset = navRect.bottom + 12;
      const nextTop = Math.max(0, target.offsetTop - offset);

      main.scrollTo({
        top: nextTop,
        behavior: smooth && !prefersReducedMotion ? "smooth" : "auto"
      });

      // Keep the document viewport pinned so hash updates do not shift fixed UI.
      if (window.scrollY !== 0) {
        window.scrollTo({ top: 0, left: 0, behavior: "auto" });
      }
    };

    navLinks.forEach((link) => {
      link.addEventListener("click", (event) => {
        const hash = link.getAttribute("href");
        if (!hash?.startsWith("#")) return;
        event.preventDefault();
        scrollToHash(hash, true);
        if (window.location.hash !== hash) {
          history.pushState(null, "", hash);
        }
      });
    });

    const syncHashScroll = () => {
      if (!window.location.hash) return;
      scrollToHash(window.location.hash, false);
    };

    window.addEventListener("hashchange", syncHashScroll);
    window.addEventListener("popstate", syncHashScroll);

    requestAnimationFrame(() => {
      if (window.location.hash) {
        scrollToHash(window.location.hash, false);
      }
    });
  })();
</script>
